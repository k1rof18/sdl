CREATE DATABASE mydb;

\c mydb;

CREATE TABLE users (
	user_id UUID PRIMARY KEY,
  name TEXT NOT NULL
);

CREATE TABLE recruits (
  recruit_id UUID PRIMARY KEY,
  client_id UUID NOT null
  	REFERENCES users(user_id)
    ON DELETE CASCADE
    ON UPDATE cascade
);

CREATE TYPE recruit_stage AS ENUM ('apply', 'first');

CREATE TABLE projects (
  project_id UUID REFERENCES recruits(recruit_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
    PRIMARY KEY,
  title TEXT NOT NULL,
  stage recruit_stage NOT NULL DEFAULT 'apply'
);

CREATE TABLE project_applies (
  apply_id UUID NOT NULL PRIMARY KEY,
  applicant_id UUID NOT NULL REFERENCES users(user_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  project_id UUID NOT NULL REFERENCES projects(project_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  budget INT
);

CREATE TABLE project_applicant_stages (
  apply_id UUID NOT NULL REFERENCES project_applies(apply_id)
    ON DELETE CASCADE
    ON UPDATE cascade
    PRIMARY KEY,
  stage recruit_stage NOT NULL DEFAULT 'apply'
);

-- 以下はサンプルデータ
INSERT INTO users (user_id, name) VALUES
('0253471B-6BB2-4D71-8EB5-C4E9C08093DB', 'Alice'),
('41408FB4-C3A3-44D4-9C47-888CDC794009', 'Bob'),
('8821E593-62F3-4ADD-9AE9-9F5B5F0A5B1F', 'Charlie');

INSERT INTO recruits (recruit_id, title, user_id) VALUES
('511B9463-47FF-46AB-9226-4C60BE25BF1C', 'Software Engineer', '0253471B-6BB2-4D71-8EB5-C4E9C08093DB'),
('88D755CF-95EE-4CCD-A3FD-12E0C4A65350', 'Product Manager', '0253471B-6BB2-4D71-8EB5-C4E9C08093DB'),
('5781EB98-456C-48E0-A85B-D0E6F87F4430', 'Designer', '0253471B-6BB2-4D71-8EB5-C4E9C08093DB');

INSERT INTO projects (project_id, stage) VALUES
('511B9463-47FF-46AB-9226-4C60BE25BF1C', 'apply'),
('88D755CF-95EE-4CCD-A3FD-12E0C4A65350', 'apply'),
('5781EB98-456C-48E0-A85B-D0E6F87F4430', 'first');

INSERT INTO project_applies (applicant_id, project_id, budget) VALUES
('41408FB4-C3A3-44D4-9C47-888CDC794009', '511B9463-47FF-46AB-9226-4C60BE25BF1C', 1000000),
('8821E593-62F3-4ADD-9AE9-9F5B5F0A5B1F', '511B9463-47FF-46AB-9226-4C60BE25BF1C', 2000000),
('41408FB4-C3A3-44D4-9C47-888CDC794009', '5781EB98-456C-48E0-A85B-D0E6F87F4430', 3000000);

